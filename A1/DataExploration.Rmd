---
title: "BCB420 - Computational Systems Biology"
subtitle: "Dataset Exploration"
author: "Chloe Nichole Calica"
output:
  html_document:
    toc: true
    toc_depth: 2
# bibliography: references.bib
# csl: biomed-central.csl
---

```{r, warning=FALSE, message=FALSE}
# Load Libraries
library(GEOquery)
library(knitr)
```

# Dataset Summary
```{r, message=FALSE}
dataset_geoID <- "GSE194294"

gse <- getGEO(dataset_geoID, GSEMatrix=FALSE)
```
**Summary:** `r gse@header$summary`

# Information about Platform
```{r}
curr_gpl <- names(GPLList(gse))[1]
curr_gpl_info <- Meta(getGEO(curr_gpl))
```

- **Platform title:** `r curr_gpl_info$title`
- **Submission date:** `r curr_gpl_info$submission_date`
- **Last update date:** `r curr_gpl_info$last_update_date`
- **Organism:** `r curr_gpl_info$organism`
- **Number of GEO datasets that use this technology:** `r length(curr_gpl_info$series_id)`
- **Number of GEO samples that use this technology:** `r length(curr_gpl_info$sample_id)`

# Information about the data and its processing
```{r, eval=FALSE}
gse@gsms[[1]]@header$data_processing
```
`r paste("* ", gse@gsms[[1]]@header$data_processing, collapse = "\n")`

# Get the Expression Data File
```{r}
# Get supplementary files
supp_files <- getGEOSuppFiles(dataset_geoID, fetch_files = FALSE)
```
`r paste("* ", supp_files$fname, collapse = "\n")`

Notice that this info is also included in the last three bullet points of the previous section. The file names are straightforward and there is also a brief description about each one.

Use the dataset containing both cell lines: **`r supp_files$fname[1]`**
```{r}
data_filename <- supp_files$fname[1]

# specify location
download_dir <- file.path(getwd())

# check to see if file exists already before downloading
# only download files that we don't have
missing_files <- supp_files$fname[!unlist(
  lapply(supp_files$fname, FUN=function(x){
    file.exists(
      file.path(download_dir, dataset_geoID, x)
    )
  })
)]

if(length(missing_files) > 0){
  for(i in 1:length(missing_files)){
    sfiles <- getGEOSuppFiles(dataset_geoID,
                              filter_regex = missing_files[i],
                              baseDir = download_dir,
                              fetch_files = TRUE)
  }
}

```
# Read the Data
```{r}
both_cells_data <- read.csv(
  file.path(download_dir, dataset_geoID, data_filename),
            header = TRUE,
            check.names = TRUE)

dim(both_cells_data)

kable(head(both_cells_data))
```
The dimensions of the data seem right. In the paper, they indicated that 26919 genes in HUVEC and 29367 in HEK-293 were found. Although this is not exactly the number of rows above, this is close enough as differences may simply be due to the merging of the two files together. 

As for the columns, they indicated that there were 12 samples and this is exactly what we see in the table, with the 13th column being the gene names. However, the column names are in some sort of a code so we would have to get more information about them.

# Deciphering Column Names
Titles include the codes for the column names and specifies the cell line and treatment undergone by each sample.
```{r}
gse@gsms[[1]]@header$title
```

GEO accession for each sample.
```{r}
gse@gsms[[1]]@header$geo_accession
```

Additional Information on each sample
```{r}
gse@gsms[[1]]@header$characteristics_ch1
```

# Collect Additional Annotation
```{r}
samples <- gse@gsms
sample_types <- do.call(rbind, 
                        lapply(samples, 
                               FUN=function(x){
                                 c(x@header$title,
                                   x@header$characteristics_ch1)
  
}))

# head(sample_types)
```

Clean up sample descriptions.
```{r}
colnames(sample_types) <- c("title", "cell line", "cell type", "treatment")

sample_types[, "cell line"] <- gsub(sample_types[, "cell line"], 
                               pattern = "cell line: ",
                               replacement = "")

sample_types[, "cell type"] <- gsub(sample_types[, "cell type"], 
                               pattern = "cell type: ",
                               replacement = "")

sample_types[, "treatment"] <- gsub(sample_types[, "treatment"], 
                               pattern = "treatment: ",
                               replacement = "")

kable(head(sample_types))
```


